<div class="container">
  <div class="header">
    <div class="header-icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <path
          d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
        </path>
        <polyline points="7.5 4.21 12 6.81 16.5 4.21"></polyline>
        <polyline points="7.5 19.79 7.5 14.6 3 12"></polyline>
        <polyline points="21 12 16.5 14.6 16.5 19.79"></polyline>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
        <line x1="12" y1="22.08" x2="12" y2="12"></line>
      </svg>
    </div>
    <h1>{{ title }}</h1>
    <p class="header-subtitle">Extract, Transform, Load Medical Codes</p>
  </div>

  <div class="form-container" *ngIf="!isProcessing && !requestId">
    <h2 class="section-title">Configuration</h2>
    <div class="form-grid">
      <div class="form-group">
        <label for="codeType">
          <span class="label-icon">üìã</span>
          Code Type *
        </label>
        <select id="codeType" [(ngModel)]="codeType" [disabled]="isProcessing">
          <option value="">Select a code type...</option>
          <option value="CPT-4">CPT-4</option>
          <option value="ICD-10-CM">ICD-10-CM</option>
          <option value="HCPCS">HCPCS</option>
        </select>
      </div>

      <div class="form-group">
        <label for="codeVersion">
          <span class="label-icon">üè∑Ô∏è</span>
          Code Version *
        </label>
        <select id="codeVersion" [(ngModel)]="codeVersion" [disabled]="isProcessing">
          <option value="">Select a year...</option>
          <option value="2025">2025</option>
          <option value="2024">2024</option>
          <option value="2023">2023</option>
          <option value="2022">2022</option>
          <option value="2021">2021</option>
          <option value="2020">2020</option>
          <option value="2019">2019</option>
          <option value="2018">2018</option>
          <option value="2017">2017</option>
          <option value="2016">2016</option>
          <option value="2015">2015</option>
          <option value="2014">2014</option>
          <option value="2013">2013</option>
          <option value="2012">2012</option>
          <option value="2011">2011</option>
          <option value="2010">2010</option>
          <option value="2009">2009</option>
          <option value="2008">2008</option>
          <option value="2007">2007</option>
          <option value="2006">2006</option>
          <option value="2005">2005</option>
          <option value="2004">2004</option>
          <option value="2003">2003</option>
          <option value="2002">2002</option>
          <option value="2001">2001</option>
          <option value="2000">2000</option>
          <option value="1999">1999</option>
          <option value="1998">1998</option>
          <option value="1997">1997</option>
          <option value="1996">1996</option>
          <option value="1995">1995</option>
          <option value="1994">1994</option>
          <option value="1993">1993</option>
          <option value="1992">1992</option>
          <option value="1991">1991</option>
          <option value="1990">1990</option>
        </select>
      </div>

      <div class="form-group">
        <label for="batchSize">
          <span class="label-icon">üìä</span>
          Batch Size
        </label>
        <input type="number" id="batchSize" [(ngModel)]="batchSize" [disabled]="isProcessing" min="1" max="10000" />
      </div>
    </div>

    <div class="file-upload-section">
      <div class="file-upload-grid">
        <div class="form-group">
          <label for="newFile">
            <span class="label-icon">üìÑ</span>
            New Codes File *
          </label>
          <div class="file-input-wrapper">
            <input type="file" id="newFile" (change)="onNewFileSelected($event)" accept=".xlsx,.xls"
              [disabled]="isProcessing" />
            <span class="file-name" *ngIf="newFile">‚úì {{ newFile.name }}</span>
          </div>
        </div>

        <div class="form-group">
          <label for="oldFile">
            <span class="label-icon">üìù</span>
            Old Codes File <span class="optional-badge">Optional</span>
          </label>
          <div class="file-input-wrapper">
            <input type="file" id="oldFile" (change)="onOldFileSelected($event)" accept=".xlsx,.xls"
              [disabled]="isProcessing" />
            <span class="file-name" *ngIf="oldFile">‚úì {{ oldFile.name }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="button-group">
      <button class="btn btn-primary" (click)="startETL()"
        [disabled]="isProcessing || !codeType || !codeVersion || !newFile">
        <span class="btn-icon">‚ñ∂</span>
        Start ETL Process
      </button>
    </div>
  </div>

  <div class="progress-container" *ngIf="isProcessing || requestId">
    <div class="request-id" *ngIf="requestId">
      <strong>Request ID:</strong> {{ requestId }}
    </div>

    <div class="stepper">
      <div class="step" *ngFor="let step of steps; let i = index" [class.active]="step.status === 'active'"
        [class.completed]="step.status === 'completed'" [class.error]="step.status === 'error'">
        <div class="step-header">
          <div class="step-number">
            <span *ngIf="step.status === 'pending' || step.status === 'active'">{{ i + 1 }}</span>
            <span *ngIf="step.status === 'completed'" class="icon">‚úì</span>
            <span *ngIf="step.status === 'error'" class="icon">‚úó</span>
          </div>
          <div class="step-label">{{ step.label }}</div>
        </div>

        <div class="step-content" *ngIf="step.status !== 'pending'">
          <div class="step-message">{{ step.message }}</div>
          <div class="step-data" *ngIf="step.data">
            <div *ngIf="step.data.total"><span class="data-label">Total Rows:</span> {{ step.data.total | number }}
            </div>
            <div *ngIf="step.data.processedNewCodes"><span class="data-label">Processed:</span> {{
              step.data.processedNewCodes | number }}</div>
            <div *ngIf="step.data.newCodes !== undefined"><span class="data-label">New:</span> {{ step.data.newCodes |
              number }}</div>
            <div *ngIf="step.data.oldCodes !== undefined"><span class="data-label">Old:</span> {{ step.data.oldCodes |
              number }}</div>
            <div *ngIf="step.data.records !== undefined"><span class="data-label">Records:</span> {{ step.data.records |
              number }}</div>
            <div *ngIf="step.data.ms"><span class="data-label">Time:</span> {{ step.data.ms | number:'1.0-2' }}ms</div>
          </div>
        </div>

        <div class="step-line" *ngIf="i < steps.length - 1"></div>
      </div>
    </div>

    <div class="button-group" *ngIf="!isProcessing">
      <button class="btn btn-secondary" (click)="reset()">
        <span class="btn-icon">üîÑ</span>
        Start New Process
      </button>
    </div>
  </div>
</div>